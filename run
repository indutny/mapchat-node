#!/usr/bin/env node

var argv = require('optimist').argv,
    env = argv.env ? '.' + argv.env : '',
    server = require('./config/server' + env)
    db = require('./config/db' + env),
    loader = require('./lib/loader');
    
function init(db) {
  var modules = loader(__dirname + '/modules', {
                 db: db,
                 modules: '?'
               }),
      routes = {};
  
  routes = loader.invokeForArray(modules, 'routes');
  
  server(routes);
}

db(init);
